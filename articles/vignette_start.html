<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Bayesian nonparametric inference with inferno • inferno</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian nonparametric inference with inferno">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">inferno</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/vignette_mutualinfo.html">Associations of variates with mutual information</a></li>
    <li><a class="dropdown-item" href="../articles/vignette_parkinson.html">Example of use: inferences for Parkinson's Disease</a></li>
    <li><a class="dropdown-item" href="../articles/vignette_start.html">Bayesian nonparametric inference with inferno</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pglpm/inferno/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Bayesian nonparametric inference with inferno</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pglpm/inferno/blob/main/vignettes/vignette_start.Rmd" class="external-link"><code>vignettes/vignette_start.Rmd</code></a></small>
      <div class="d-none name"><code>vignette_start.Rmd</code></div>
    </div>

    
    
<p>This vignette gives an introduction and guide to the kinds of
<em>Bayesian nonparametric inference</em> that can be done with
<strong><em>inferno</em></strong>, by means of a concrete example. It
also has the purpose to clarify the terminology used in the
<strong><em>inferno</em></strong> package.</p>
<p><br></p>
<div class="section level2">
<h2 id="before-we-start">Before we start<a class="anchor" aria-label="anchor" href="#before-we-start"></a>
</h2>
<p>It is of course impossible to summarize this branch of probability
theory and of statistics in a couple of sections; you’re invited to
learn more for instance from the texts given in the <a href="#references">references</a>.</p>
<p>Two extremely important warnings before you follow the example:</p>
<ul>
<li>
<p>Some terms may sound familiar to you, but keep in mind that they
may have quite different meanings from what you’re used to. This is
especially true of the terms in <em>italics</em>. When you see a term in
<strong>boldface</strong>, try to understand its meaning from the way
it’s used, rather than assuming the meaning familiar to you.
Unfortunately, different methods and different disciplines use the same
terms in different ways.</p>
<p>In particular keep in mind that the term <strong>probability</strong>
does <em>not</em> mean <strong>frequency</strong>. ‘Probability’ means
‘plausibility’, or ‘credibility’, or ‘degree of belief’: it is a
quantification of our uncertainty about some possible fact. There is a
connection between probability and frequency, but they are not the same.
The distinction is important because one of the main problems in
statistical inference is that <em>we are uncertain about the frequency
of something</em> – the occurrence of a disease, symptom, or other
characteristics – and our goal is to quantify and reduce that
uncertainty as much as possible. The frequency of something in a
population or group or collection is a static value, often unknown.
Probability is something dynamic: it updates when new information
becomes available.</p>
</li>
<li><p>The example that follows is, like every example, very specific.
But try to see the more general, abstract picture behind it, and to see
how its general methodology could be applied to research that is more
interesting to you. From time to time we shall draw analogies with other
examples that may look very different and yet use essentially the same
methodology.</p></li>
</ul>
<p><br>
You’re now welcome to open R in your favourite integrated development
environment, choose a directory to work in, and test yourself the code
that follows. Let’s start by loading the
<strong><em>inferno</em></strong> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pglpm/inferno/" class="external-link">inferno</a></span><span class="op">)</span></span></code></pre></div>
<p>In our example we shall use data from the <code>penguins</code>
dataset, included in R version 4.5.0 and above. We shuffle this dataset
to erase any particular ordering of its data, and call the new dataset
<code>penguin</code> (without the final ‘s’). For your convenience you
can download the shuffled dataset as the CSV file <a href="https://github.com/pglpm/inferno/raw/main/development/downloads/penguin_data.csv" class="external-link"><code>'penguin_data.csv'</code></a>.
Otherwise you can create such file from R 4.5.0 or above as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span> <span class="co">## replace with your favourite seed number</span></span>
<span><span class="va">penguin</span> <span class="op">&lt;-</span> <span class="va">penguins</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span> <span class="co">## shuffle</span></span>
<span></span>
<span><span class="fu"><a href="../reference/inferno.data.html">write.csvi</a></span><span class="op">(</span><span class="va">penguin</span>, file <span class="op">=</span> <span class="st">'penguin_data.csv'</span><span class="op">)</span></span></code></pre></div>
<p>The utility function <code><a href="../reference/inferno.data.html">write.csvi()</a></code> saves the dataset as a
CSV file that respects the <a href="#format">formatting rules required
by <strong><em>inferno</em></strong></a>.</p>
<p>We assume that you now have the <code>'penguin_data.csv'</code>
file.</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="penguins">Penguins<a class="anchor" aria-label="anchor" href="#penguins"></a>
</h2>
<p>We are researchers interested in penguins; specifically the
<strong>population</strong> living in the Antarctic islands
<em>Biscoe</em>, <em>Dream</em>, <em>Torgersen</em>. Our research
questions are not yet precisely defined, but some initial questions of
interest are the following. The penguins can be of three species: <a href="https://www.bas.ac.uk/about/antarctica/wildlife/penguins/adelie-penguin/" class="external-link"><em>Adélie</em></a>,
<a href="https://www.bas.ac.uk/about/antarctica/wildlife/penguins/chinstrap-penguin/" class="external-link"><em>Chinstrap</em></a>,
<a href="https://www.bas.ac.uk/about/antarctica/wildlife/penguins/gentoo-penguin/" class="external-link"><em>Gentoo</em></a>;
we’d like to know:</p>
<dl>
<dt>Q1</dt>
<dd>
What’s the overall statistical occurrence of the three species,
independently of location or other details? In other words, what is the
relative frequency of each species in the population?
</dd>
<dt>Q2</dt>
<dd>
Do the three species differ, <em>statistically</em>, in some physical or
geographical characteristic such as sex or island of origin? We say
“statistically” because, for instance, there surely are females and
males of every species, but it’s possible that for one of the species
the ratio of females to males is higher than for another species.
</dd>
<dt>Q3</dt>
<dd>
Is there a physical or geographical characteristic that allows us to
make a good guess about a penguin’s species? We say “guess” because, for
instance, from knowing which island a penguin comes from we can’t be
100% sure about that penguin’s species.
</dd>
</dl>
<p>In order to approach these and other future questions, we decide
which set of penguin characteristics we should consider and observe.
These characteristics are called the <strong>variates</strong> of the
population. This set can be extended or reduced later on. Guided by
previous studies, or by some hypotheses we are entertaining, we choose
the following variates, each denoted by a short
<code>codeword</code>:</p>
<ul>
<li>Species (<code>species</code>)</li>
<li>Island (<code>island</code>)</li>
<li>Bill (<code>bill_len</code>): <a href="https://allisonhorst.github.io/palmerpenguins/reference/figures/culmen_depth.png" class="external-link">the
length of a penguin’s “beak”</a> in millimetres</li>
<li>Bill depth (<code>bill_dep</code>): <a href="https://allisonhorst.github.io/palmerpenguins/reference/figures/culmen_depth.png" class="external-link">the
depth of a penguin’s “beak”</a> in millimetres</li>
<li>Flipper length (<code>flipper_len</code>): the length of a penguin’s
“wing” in millimetres</li>
<li>Body mass (<code>body_mass</code>) in grams</li>
<li>Sex (<code>sex</code>)</li>
<li>Study year (<code>year</code>): the year a penguin was observed and
measured</li>
</ul>
<p>We include the last variate because there could be time trends in the
values we observe. For instance, a particular species might have more
females than males during one year, and vice versa during another
year.</p>
<div class="section level3">
<h3 id="population">“Population”?<a class="anchor" aria-label="anchor" href="#population"></a>
</h3>
<p>The question of time-trends leads us to more general considerations
and questions about statistical research, which unfortunately are often
forgotten.</p>
<p>To start with: this “population” which we want to study, how is it
defined exactly? What counts as a member of the population, and what
doesn’t? For example, a seal clearly doesn’t count, because it isn’t a
penguin. A penguin from the Galápagos island doesn’t count either,
because it isn’t from one of the three Antarctic islands we specified.
But does a penguin who was alive in the year 1830 count? what about one
who will live in those islands in the year 2100? Does a penguin with
some kind of notable physical impairment count? Does a penguin who only
lived 1 year count? Does a penguin born in the Galápagos island but
subsequently transported to the Antarctic islands count?</p>
<p>No matter which research field you work in, you realize that
analogous questions appear when you try to define the “population” in
some study.</p>
<p>It is practically impossible to specify an exact criterion for
membership in a population under study. We may try to cover and delimit
as many factors as possible, but there may always appear a new one we
didn’t think of. There’s no “objective” specification of a population:
the specification depends on our research purpose – which often is not
precisely specified either. We must therefore always be prepared to
further specify the population of our study. In some cases we may even
need to modify our previous specification, and thus discard some data or
acquire new ones.</p>
<p>The intrinsic and unavoidable problem in the specification of a
population has important consequences for the way we observe and measure
the population and its variates. We now turn to this problem.</p>
</div>
<div class="section level3">
<h3 id="sampling">Sampling<a class="anchor" aria-label="anchor" href="#sampling"></a>
</h3>
<p>Our questions <strong>Q1</strong>, <strong>Q2</strong>,
<strong>Q3</strong> could have <em>exact statistical answers</em> if we
had a <em>complete census</em> of the penguin population; that is, if we
went and “measured” the values of the variates in each and every penguin
of the population.</p>
<p>To make this point clearer, imagine a slightly different population.
Suppose we were interested only in all the penguins alive today on a
specific, very small island. The island turns out to have 17 penguins.
We check all of them. We find that 6 of these are females, and 11 are
males. It’s then a fact that 6/17${}$35.3% of penguins in this specific
population are females, and 64.7% are males. And if someone picked a
penguin from this population and asked us to guess its sex, we would
give a 35.3% probability to that penguin’s being female, and 64.7% to
its being male.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Note the difference between probability and frequency.
If an expert colleague tells us “I was able to take a quick look at that
penguin, and it looks female to me, though I’m not completely sure”,
then our &lt;em&gt;probability&lt;/em&gt; that this specific penguin is female would
get higher than 50%. If we observe the penguin and see that it’s female,
our probability for female would become 100%. Yet the &lt;em&gt;frequency&lt;/em&gt;
of females in the population is still 35.3%.&lt;/p&gt;"><sup>1</sup></a></p>
<p>But it is often impractical or impossible to take a complete census.
Think of the case were the whole population includes members or variates
that will only exist in the future. For this reason we proceed as
follows: we observe a <strong>sample</strong> of the whole population,
and from the study of this sample we try to infer the statistical
properties of the whole population. Our inferences are perforce
uncertain: we can’t be fully sure about the exact statistical properties
of the whole population. The essential point is that our uncertainty is
not just a matter of “I don’t know” versus “I know”:</p>
<ul>
<li>we can <em>quantify</em> our uncertainty;</li>
<li>we can <em>reduce</em> our uncertainty, sometimes to the point where
it becomes almost a certainty.</li>
</ul>
<p>Some trusted colleagues thus go to the three islands, and examine
samples of penguins there, sending back the values they observe. The way
they do the sampling would require a deep analysis and discussion, but
for the moment we put these aside.</p>
<p>How many samples should our colleagues collect? The short answer is:
as many as they can. The more samples we have, the more certain our
conclusions will be – all kinds of conclusions: for instance those that
may reveal the presence, as well as those that may reveal the absence,
of important associations.</p>
<p>One important feature of Bayesian inference is that <em>we don’t need
to choose beforehand when to stop sampling</em>. We can monitor the
results as more and more samples arrive, and stop as soon as the level
of certainty about the results is satisfactory. This is possible because
in Bayesian inference the <em>sample size affects only the
uncertainty</em> we have of the ground truth – association, effect, or
other hypothesis – but <em>it cannot affect the ground truth
itself</em>. If the truth is that “there is no effect”, then this truth
will come to light with more and more certainty as we increase the
sample size, and no amount of sampling will be able to change this
truth.</p>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="how-to-use-the-sample-data">How to use the sample data<a class="anchor" aria-label="anchor" href="#how-to-use-the-sample-data"></a>
</h2>
<div class="section level3">
<h3 id="a-first-preliminary-analysis">A first, preliminary analysis<a class="anchor" aria-label="anchor" href="#a-first-preliminary-analysis"></a>
</h3>
<p>Imagine that, a while after the sampling begun, our colleagues start
sending the collected sample data to us, a little batch at a time. For
the moment we assume that the batches are chosen without any systematic
order; in particular, their order is unrelated to the time of sampling.
We make this assumption in order to avoid trends, which we’ll discuss in
another vignette.</p>
<p>We receive the first 10 samples from our sampling survey and store
them in the file <code>'penguin_data10.csv'</code>, respecting the <a href="#format">formatting rules required by
<strong><em>inferno</em></strong></a>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datafile</span> <span class="op">&lt;-</span> <span class="st">'penguin_data10.csv'</span></span>
<span><span class="fu"><a href="../reference/inferno.data.html">write.csvi</a></span><span class="op">(</span><span class="va">penguin</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="op">]</span>, <span class="va">datafile</span><span class="op">)</span> <span class="co">## write the first 10 samples</span></span></code></pre></div>
<p>Here they are:</p>
<table class="table">
<colgroup>
<col width="4%">
<col width="13%">
<col width="13%">
<col width="12%">
<col width="12%">
<col width="16%">
<col width="13%">
<col width="9%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">species</th>
<th align="left">island</th>
<th align="right">bill_len</th>
<th align="right">bill_dep</th>
<th align="right">flipper_len</th>
<th align="right">body_mass</th>
<th align="left">sex</th>
<th align="right">year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">Adelie</td>
<td align="left">Torgersen</td>
<td align="right">37.8</td>
<td align="right">17.1</td>
<td align="right">186</td>
<td align="right">3300</td>
<td align="left"></td>
<td align="right">2007</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">Chinstrap</td>
<td align="left">Dream</td>
<td align="right">54.2</td>
<td align="right">20.8</td>
<td align="right">201</td>
<td align="right">4300</td>
<td align="left">male</td>
<td align="right">2008</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">Adelie</td>
<td align="left">Dream</td>
<td align="right">36.2</td>
<td align="right">17.3</td>
<td align="right">187</td>
<td align="right">3300</td>
<td align="left">female</td>
<td align="right">2008</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="left">Chinstrap</td>
<td align="left">Dream</td>
<td align="right">52.0</td>
<td align="right">19.0</td>
<td align="right">197</td>
<td align="right">4150</td>
<td align="left">male</td>
<td align="right">2007</td>
</tr>
<tr class="odd">
<td align="left">5</td>
<td align="left">Gentoo</td>
<td align="left">Biscoe</td>
<td align="right">45.3</td>
<td align="right">13.7</td>
<td align="right">210</td>
<td align="right">4300</td>
<td align="left">female</td>
<td align="right">2008</td>
</tr>
<tr class="even">
<td align="left">6</td>
<td align="left">Gentoo</td>
<td align="left">Biscoe</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="right">2009</td>
</tr>
<tr class="odd">
<td align="left">7</td>
<td align="left">Adelie</td>
<td align="left">Torgersen</td>
<td align="right">42.5</td>
<td align="right">20.7</td>
<td align="right">197</td>
<td align="right">4500</td>
<td align="left">male</td>
<td align="right">2007</td>
</tr>
<tr class="even">
<td align="left">8</td>
<td align="left">Gentoo</td>
<td align="left">Biscoe</td>
<td align="right">48.5</td>
<td align="right">15.0</td>
<td align="right">219</td>
<td align="right">4850</td>
<td align="left">female</td>
<td align="right">2009</td>
</tr>
<tr class="odd">
<td align="left">9</td>
<td align="left">Chinstrap</td>
<td align="left">Dream</td>
<td align="right">46.5</td>
<td align="right">17.9</td>
<td align="right">192</td>
<td align="right">3500</td>
<td align="left">female</td>
<td align="right">2007</td>
</tr>
<tr class="even">
<td align="left">10</td>
<td align="left">Gentoo</td>
<td align="left">Biscoe</td>
<td align="right">46.9</td>
<td align="right">14.6</td>
<td align="right">222</td>
<td align="right">4875</td>
<td align="left">female</td>
<td align="right">2009</td>
</tr>
</tbody>
</table>
<p>If you generated the <code>penguin</code> dataset yourself, then your
first 10 samples may be different.</p>
<p>In the data above, samples #1 and #6 have one or more missing
variates. But incomplete data are not a problem: inferences can still be
performed from them, because Bayesian methods and
<strong><em>inferno</em></strong> automatically perform
<em>imputation</em> of missing data, and they do so in a principled way
(via the marginalization rule of probability theory).</p>
<p>With these datapoints we start our Bayesian nonparametric analysis
using <strong><em>inferno</em></strong>!</p>
<p>There are now two preliminary steps, which we must usually follow to
perform an analysis:</p>
<ol style="list-style-type: decimal">
<li>Determine and prepare the <strong>metadata</strong> about the
variates of interest.</li>
<li>Perform the general inference about the whole population from the
sampled data; we shall call this <strong>learning</strong> from the
sample data.</li>
</ol>
</div>
<div class="section level3">
<h3 id="metadata-preparation">Metadata preparation<a class="anchor" aria-label="anchor" href="#metadata-preparation"></a>
</h3>
<p>Metadata are “data about the data”. They must be provided in a CSV
file respecting the <a href="#format">formatting rules</a>, or as a
<code>data.frame</code>, and consist of around eight pieces of
information about the variates of our population:</p>
<dl>
<dt>Variate name (<code>name</code>)</dt>
<dd>
This is a character or string: name of a variate. Different variates
should obviously have different names.
</dd>
<dt>Variate type (<code>type</code>)</dt>
<dd>
<p><strong><em>inferno</em></strong> can handle three kinds of
variates:</p>
<ul>
<li>
<code>nominal</code>: it can take on a finite number of discrete
values, which do not have any natural ordering. Examples could be sex or
geographical location.</li>
<li>
<code>ordinal</code>: it can take on a finite number of discrete
values, which do have a natural ordering. They can be qualitative or
numeric. Examples could be the degree of satisfaction of a customer, or
the severity of a disease, or a <a href="https://www.britannica.com/topic/Likert-Scale" class="external-link">Likert
scale</a>.</li>
<li>
<code>continuous</code>: it can in principle take on an infinite
number of continuous values, although they can be discretized or
rounded. Examples could be age or weight.</li>
</ul>
<p>Many other types of variates exist. For example images and audio are
also types of variates; but <strong><em>inferno</em></strong> cannot
handle these complex types. A simple type of variate that
<strong><em>inferno</em></strong> cannot properly handle is the
<em>cyclic</em> one, such as time of day. There are no clear-cut
separations between different types of variates; thus it’s sometimes
difficult to assess the type.</p>
</dd>
<dt>Domain minimum and maximum (<code>domainmin</code>,
<code>domainmax</code>)</dt>
<dd>
<p>These are numbers, only defined for numeric-ordinal and continuous
variates. These metadata are the minimum and maximum value a variate can
take on in a given study. For example, in a study about health or
employment of adults, a variate <em>age</em> might have a minimum of
18 years. In a more general study involving people of all ages, the
minimum would be 0. In a health study where people of 90 years or more
are pooled together, the maximum would be 90 years. A minimum could also
be minus-infinity, and a maximum plus-infinity. Obviously the minimum
should be lower than the maximum.</p>
<p>Sometimes the minimum or maximum is not clear-cut. For instance,
there is no theoretical maximum on a person’s age, although we can
consider an age of 300 impossible to reach today. In such cases the
maximum or minimum can be taken to be plus or minus infinity.</p>
</dd>
<dt>Interval between values (<code>datastep</code>)</dt>
<dd>
This is a positive number, only defined for numeric-ordinal and
continuous variates. It is the separation between consecutive values.
For example, in a 1–5 Likert-scale variate, the interval is 1. For an
<em>age</em> variate expressed in and rounded to years, the interval
is 1. For a <em>length</em> variate expressed in centimetres and rounded
to millimetres, the interval is 0.1.
</dd>
<dt>Inclusion of inimum and maximum (<code>minincluded</code>,
<code>maxincluded</code>)</dt>
<dd>
These are logical or <code>yes</code>/<code>no</code>, only defined for
continuous variates. They tell whether the minimum and maximum of a
continuous variate are themselves possible values or not. Often such
extreme values have a special meaning, and this information is important
with censored or pooled data. For example, a <em>length</em> continuous
variate might be expressed in decimetres and reported without rounding,
but all lengths above 1 dm might be pooled together into the value “1 dm
or more”; in such case we must make sure to state that
<code>maxincluded</code> is <code>TRUE</code> or <code>"yes"</code>.
</dd>
<dt>Values (<code>V1</code>, <code>V2</code>, …)</dt>
<dd>
These are characters or strings, only defined for nominal or non-numeric
ordinal variates. They are the values that a nominal or ordinal variate
can <em>in principle</em> take on in the population of interest. Note
that they are include not only the values that are observed in a sample,
but also those that could be observed in the rest of the population. A
nominal or ordinal variate must have at least two distinct values; it
wouldn’t make much sense to draw inferences about it otherwise. The
metadata file can contain further empty <strong>V…</strong> columns.
</dd>
</dl>
<p>Why does <strong><em>inferno</em></strong> need metadata? Because it
performs <em>nonparametric</em> inference. In other words, it does not
assume the frequency distribution of the variates in the whole
population to have any specific class of shapes, such as a Gaussians. It
tries to extrapolate the frequency distribution of the whole population
from the sample data provided. We must therefore provide to it the same
general information that we have about the variates, and about any
artificial modifications performed on their values, such as rounding or
pooling.</p>
<p>In order to prepare the metadata file we can use
<strong><em>inferno</em></strong>’s <code><a href="../reference/metadatatemplate.html">metadatatemplate()</a></code>
helper function. This function reads the sample data and prepares a
preliminary file containing heuristic <em>guesses</em> about the
metadata. We must then check and correct this file. The function
motivates its guesses and warns about especially uncertain ones. Here is
the code to generate a <code>'penguin_metadata.csv'</code> file, and the
output and warnings of the helper function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadatafile</span> <span class="op">&lt;-</span> <span class="st">'penguin_metadata.csv'</span></span>
<span></span>
<span><span class="fu"><a href="../reference/metadatatemplate.html">metadatatemplate</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">datafile</span>, file <span class="op">=</span> <span class="va">metadatafile</span><span class="op">)</span></span>
<span><span class="co"># Analyzing 8 variates for 10 datapoints.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * "species" variate:</span></span>
<span><span class="co">#   -  3 different  values detected:</span></span>
<span><span class="co">#  "Adelie", "Chinstrap", "Gentoo" </span></span>
<span><span class="co">#   which do not seem to refer to an ordered scale.</span></span>
<span><span class="co">#   Assuming variate to be NOMINAL.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * "island" variate:</span></span>
<span><span class="co">#   -  3 different  values detected:</span></span>
<span><span class="co">#  "Biscoe", "Dream", "Torgersen" </span></span>
<span><span class="co">#   which do not seem to refer to an ordered scale.</span></span>
<span><span class="co">#   Assuming variate to be NOMINAL.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * "bill_len" variate:</span></span>
<span><span class="co">#   - Numeric values between 36.2 and 54.2 </span></span>
<span><span class="co">#   Assuming variate to be CONTINUOUS.</span></span>
<span><span class="co">#   - Distance between datapoints is a multiple of 0.1 </span></span>
<span><span class="co">#   Assuming variate to be ROUNDED.</span></span>
<span><span class="co">#   - All values are positive</span></span>
<span><span class="co">#   Assuming "domainmin" to be 0</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * "bill_dep" variate:</span></span>
<span><span class="co">#   - Numeric values between 13.7 and 20.8 </span></span>
<span><span class="co">#   Assuming variate to be CONTINUOUS.</span></span>
<span><span class="co">#   - Distance between datapoints is a multiple of 0.1 </span></span>
<span><span class="co">#   Assuming variate to be ROUNDED.</span></span>
<span><span class="co">#   - All values are positive</span></span>
<span><span class="co">#   Assuming "domainmin" to be 0</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * "flipper_len" variate:</span></span>
<span><span class="co">#   - Only 8 different numeric values detected:</span></span>
<span><span class="co"># from 186 to 222 in steps of 1 </span></span>
<span><span class="co">#   Assuming variate to be ORDINAL.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * "body_mass" variate:</span></span>
<span><span class="co">#   - Only 7 different numeric values detected:</span></span>
<span><span class="co"># from 3300 to 4875 in steps of 25 </span></span>
<span><span class="co">#   Assuming variate to be ORDINAL.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * "sex" variate:</span></span>
<span><span class="co">#   -  2 different  values detected:</span></span>
<span><span class="co">#  "female", "male" </span></span>
<span><span class="co">#   which do not seem to refer to an ordered scale.</span></span>
<span><span class="co">#   Assuming variate to be NOMINAL.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * "year" variate:</span></span>
<span><span class="co">#   - Only 3 different numeric values detected:</span></span>
<span><span class="co"># from 2007 to 2009 in steps of 1 </span></span>
<span><span class="co">#   Assuming variate to be ORDINAL.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># =========</span></span>
<span><span class="co"># WARNINGS - please make sure to check these variates in the metadata file:</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># * "year" variate appears to have been rounded</span></span>
<span><span class="co"># and then transformed to logarithmic scale.</span></span>
<span><span class="co"># This may lead to problems in the inference.</span></span>
<span><span class="co"># Preferably, transform it back to non-logarithmic scale.</span></span>
<span><span class="co"># =========</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Saved proposal metadata file as "penguin_metadata.csv" </span></span></code></pre></div>
<p>The preliminary metadata file created by
<code><a href="../reference/metadatatemplate.html">metadatatemplate()</a></code> looks like this:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="9%">
<col width="8%">
<col width="7%">
<col width="7%">
<col width="6%">
<col width="9%">
<col width="9%">
<col width="5%">
<col width="7%">
<col width="7%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="2%">
<col width="3%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="left">name</th>
<th align="left">type</th>
<th align="right">domainmin</th>
<th align="right">domainmax</th>
<th align="right">datastep</th>
<th align="right">minincluded</th>
<th align="right">maxincluded</th>
<th align="left">V1</th>
<th align="left">V2</th>
<th align="left">V3</th>
<th align="right">V4</th>
<th align="right">V5</th>
<th align="right">V6</th>
<th align="right">V7</th>
<th align="right">V8</th>
<th align="right">V9</th>
<th align="right">V10</th>
<th align="right">V11</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">species</td>
<td align="left">nominal</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="left">Adelie</td>
<td align="left">Chinstrap</td>
<td align="left">Gentoo</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">island</td>
<td align="left">nominal</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="left">Biscoe</td>
<td align="left">Dream</td>
<td align="left">Torgersen</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">bill_len</td>
<td align="left">continuous</td>
<td align="right">0</td>
<td align="right"></td>
<td align="right">0.1</td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">bill_dep</td>
<td align="left">continuous</td>
<td align="right">0</td>
<td align="right"></td>
<td align="right">0.1</td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">flipper_len</td>
<td align="left">ordinal</td>
<td align="right">186</td>
<td align="right">222</td>
<td align="right">1.0</td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">body_mass</td>
<td align="left">ordinal</td>
<td align="right">3300</td>
<td align="right">4875</td>
<td align="right">25.0</td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="left">nominal</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="left">female</td>
<td align="left">male</td>
<td align="left"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="left">ordinal</td>
<td align="right">2007</td>
<td align="right">2009</td>
<td align="right">1.0</td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
</tr>
</tbody>
</table>
<p>If you generated the <code>penguin</code> dataset yourself, then you
might obtain different guesses. Try to follow the following guidelines
for the present example.</p>
<p>We see that <code><a href="../reference/metadatatemplate.html">metadatatemplate()</a></code> guessed correctly about
the <code>species</code>, <code>island</code>, <code>sex</code>
variates: they are of <code>'nominal'</code> type, and all their
possible values are correctly listed. If any of the possible values are
missing from the sample, and therefore missing in the preliminary
metadata, then we should add them under the additional
<strong>V…</strong> columns. Note that we can sort the nominal values in
any order we please.</p>
<p>Also the <code>bill_len</code> and <code>bill_dep</code> variates are
correct: they are continuous, rounded to the nearest tenth of
millimetre, and cannot be less than zero. The absence of
<strong>domainmax</strong> values means that the theoretical maximum is
plus infinity. We could replace this maximum with something more
realistic, for instance <code>1000</code> mm or less, but typically this
kind of changes do not lead to relevant differences in our inferences.
The absence of <strong>minincluded</strong> means that the minimum,
<code>0</code>, is not a possible value; similarly for
<strong>maxincluded</strong>.</p>
<p>The <code>year</code> variate is correctly classified as ordinal,
with values between 2007 and 2009. If the sampling had a later end date,
we would correct the 2009 value. The <code>year</code> variate could
alternatively be considered continuous and rounded; in the present case
this alternative classification wouldn’t affect our inferences:
<strong><em>inferno</em></strong> treats this kind of ambiguous cases in
the same way.</p>
<p>Also the <code>sex</code> variate is correctly guessed:
<code>nominal</code> type with possible values <code>'female'</code> and
<code>'male'</code>.</p>
<p><br>
The guesses about the <code>flipper_len</code> and
<code>body_mass</code> variates are not correct, however: these variates
are continuous, with a minimal value of <code>0</code> and no maximal
value. They are rounded to <code>1</code> mm and <code>25</code> g (this
was correctly guessed).</p>
<p>We must open the preliminary metadata file
<code>'penguin_metadata.csv'</code> with our favourite editor, and
correct and complete the guesses of the helper function. In this case we
end up with the following corrected metadata file, also available for
download as <a href="https://github.com/pglpm/inferno/raw/main/development/downloads/penguin_metadata.csv" class="external-link"><code>'penguin_data.csv'</code></a>:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="11%">
<col width="10%">
<col width="9%">
<col width="9%">
<col width="8%">
<col width="11%">
<col width="11%">
<col width="6%">
<col width="9%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="left">name</th>
<th align="left">type</th>
<th align="right">domainmin</th>
<th align="right">domainmax</th>
<th align="right">datastep</th>
<th align="right">minincluded</th>
<th align="right">maxincluded</th>
<th align="left">V1</th>
<th align="left">V2</th>
<th align="left">V3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">species</td>
<td align="left">nominal</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="left">Adelie</td>
<td align="left">Chinstrap</td>
<td align="left">Gentoo</td>
</tr>
<tr class="even">
<td align="left">island</td>
<td align="left">nominal</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="left">Biscoe</td>
<td align="left">Dream</td>
<td align="left">Torgersen</td>
</tr>
<tr class="odd">
<td align="left">bill_len</td>
<td align="left">continuous</td>
<td align="right">0</td>
<td align="right"></td>
<td align="right">0.1</td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">bill_dep</td>
<td align="left">continuous</td>
<td align="right">0</td>
<td align="right"></td>
<td align="right">0.1</td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">flipper_len</td>
<td align="left">continuous</td>
<td align="right">0</td>
<td align="right"></td>
<td align="right">1.0</td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">body_mass</td>
<td align="left">continuous</td>
<td align="right">0</td>
<td align="right"></td>
<td align="right">25.0</td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="left">nominal</td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="right"></td>
<td align="left">female</td>
<td align="left">male</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">year</td>
<td align="left">ordinal</td>
<td align="right">2007</td>
<td align="right">2009</td>
<td align="right">1.0</td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="learningfirst">“Learning” and extrapolating from the sample data<a class="anchor" aria-label="anchor" href="#learningfirst"></a>
</h3>
<p>Now comes the essential part of our analysis: from the sample data
and the metadata information,<strong><em>inferno</em></strong> will draw
inferences about the <em>whole</em> population of penguins, including
new penguins (from the same population) that we shall observe in the
future. Subsequent analyses are based on this main inference. The
general theory behind this kind of inference, based on the property of
<em>exchangeability</em> and related mathematical theorems, is explained
in the <a href="#references">references</a>.</p>
<p>This inference is performed by calling the <code><a href="../reference/learn.html">learn()</a></code>
function. Its minimal arguments are three: the sample <code>data</code>,
the <code>metadata</code>, and the name <code>outputdir</code> of a
directory where the inference results should be saved; some additional
information will be suffixed to this directory name. We can also give a
numeric <code>seed</code> argument if we want to reproduce the same
output in another run, and a <code>parallel</code> argument specifying
the number of cores to be used for parallel computation.</p>
<p>This function in fact does Monte Carlo sampling and is
computationally expensive. It may take minutes, hours, or days to run,
depending on the amount of sample data and the number of variates. In
order to speed up its computations, it tries to use any multi-cores
capabilities of the machine it runs in, or the number of cores specified
in the <code>parallel</code> argument (which shouldn’t be larger than
the number of cores you actually have!).</p>
<p>The output below was obtained from running <code><a href="../reference/learn.html">learn()</a></code> on 4
cores – <em>please wait before running this code</em>, it might take
longer time on your computer:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">learnt10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/learn.html">learn</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">datafile</span>,</span>
<span>    metadata <span class="op">=</span> <span class="va">metadatafile</span>,</span>
<span>    outputdir <span class="op">=</span> <span class="st">'penguin_inference'</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    parallel <span class="op">=</span> <span class="fl">4</span> <span class="co">## how many cores to use for the computation</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Registered doParallelSNOW with 4 workers</span></span>
<span><span class="co"># Calculating auxiliary metadata</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Learning:  10 datapoints,  8 variates</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#  *************************************************** </span></span>
<span><span class="co">#  Saving output in directory</span></span>
<span><span class="co">#  penguin_inference-261031T122336-vrt8_dat10_smp3600 </span></span>
<span><span class="co">#  *************************************************** </span></span>
<span><span class="co"># Starting Monte Carlo sampling of 3600 samples by 60 chains</span></span>
<span><span class="co"># in a space of 1027 (effectively 3851) dimensions.</span></span>
<span><span class="co"># Using 4 cores: 60 samples per chain, max 15 chains per core.</span></span>
<span><span class="co"># Core logs are being saved in individual files.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># C-compiling samplers appropriate to the variates (package Nimble)</span></span>
<span><span class="co"># this can take tens of minutes. Please wait...</span></span>
<span><span class="co"># Compiled core 1. Number of samplers: 1078.       </span></span>
<span><span class="co"># Estimating remaining time, please be patient...</span></span>
<span><span class="co"># Sampling. Core 4 estimated end time: 2026-10-31 12:31</span></span>
<span><span class="co"># Finished Monte Carlo sampling.                                 </span></span>
<span><span class="co"># Highest number of Monte Carlo iterations across chains: 3600 </span></span>
<span><span class="co"># Highest number of used mixture components: 10 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Checking test data</span></span>
<span><span class="co"># ( #1 #3 #4 #5 #6 #7 #8 #9 #10 )</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># rel. MC standard error: min: 0.017  max: 0.048  mean: 0.025 </span></span>
<span><span class="co"># eff. sample size: min: 430  max: 3500  mean: 2200 </span></span>
<span><span class="co"># needed thinning: min: 2  max: 13  mean: 4.1 </span></span>
<span><span class="co"># average: min: 1.6e-08  max: 0.12  mean: 0.014 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Plotting final Monte Carlo traces and marginal samples...</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Total computation time: 4.7 mins </span></span>
<span><span class="co"># Average preparation &amp; finalization time: 1 mins </span></span>
<span><span class="co"># Average Monte Carlo time per chain: 13 secs </span></span>
<span><span class="co"># Max total memory used: approx 3500 MB</span></span>
<span><span class="co"># Max memory used per core: approx 860 MB</span></span>
<span><span class="co"># ## </span></span>
<span><span class="co"># Removing temporary output files.</span></span>
<span><span class="co"># Finished.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Closing connections to cores.</span></span></code></pre></div>
<p>The initial output gives a summary of the sample size, number of
variates, saving directory, and other computational details. The
“<code>estimated end time</code>” line is updated from time to time with
a better estimate of the computation’s end time. Once the computation is
finished, some final information about the underlying Monte Carlo
computation and time and memory use is provided.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The Monte Carlo expert will notice that the effective
sample size is around 900 or more. The Monte Carlo sampling is designed
to stop when 3600 samples have been obtained with an effective sample
size of at least 400, or equivalently a relative Monte Carlo standard
error under 0.05. This is enough, considering that the statistical
uncertainty in the results can be tens or hundreds of times larger than
this. The desired number of samples and maximal Monte Carlo standard
error can be specified with the &lt;code&gt;nsamples&lt;/code&gt; and
&lt;code&gt;relerror&lt;/code&gt; arguments.&lt;/p&gt;"><sup>2</sup></a> Note that the
inference above, with 10 sample data and 8 variates, took around 4 GB
and 5 minutes to complete on 4 cores.</p>
<p>The results of this main inference are now stored in the compressed
file <code>'learnt.rds'</code> (around 30 MB) within the specified
output directory. The name of this directory is also saved as the final
value of the <code><a href="../reference/learn.html">learn()</a></code> function. We saved this directory name
in the <code>learnt10</code> variable in the code above, by invoking
<code>learnt10 &lt;- learn(...)</code>.</p>
<p>For your convenience the object produced by the computation above can
be downloaded as the file <a href="https://github.com/pglpm/inferno/raw/main/development/downloads/learnt10.rds" class="external-link"><code>'learnt10.rds'</code></a>.
Once you have downloaded it in your working directory you can just
invoke</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">learnt10</span> <span class="op">&lt;-</span> <span class="st">'learnt10.rds'</span></span></code></pre></div>
<p>which produces an object <code>learnt10</code> (just a string, in
this case) which can be used in the following analysis.</p>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="prelimQ1">Analysis example: frequencies of species<a class="anchor" aria-label="anchor" href="#prelimQ1"></a>
</h2>
<div class="section level3">
<h3 id="estimating-relative-frequencies">Estimating relative frequencies<a class="anchor" aria-label="anchor" href="#estimating-relative-frequencies"></a>
</h3>
<p>Consider our first research question <strong>Q1</strong>: what’s the
overall statistical occurrence of the three species in the whole
population? The relative frequencies of the three species in the whole
population are unknown to us, so we cannot give a simple answer such as
“Adélie: 0.10, Chinstrap: 0.34, Gentoo: 0.56”.</p>
<p>Bayesian nonparametrics and <strong><em>inferno</em></strong> give a
first answer to this question in the form of:</p>
<ul>
<li>an <em>estimate</em> of the whole-population frequency
distribution,</li>
<li>the <em>uncertainty</em> of this estimate.</li>
</ul>
<p>We discuss both in a moment. First let’s compute them using the
<code><a href="../reference/Pr.html">Pr()</a></code> function. For the present question, this function
requires three arguments:</p>
<ul>
<li>
<code>Y</code>: a <code>data.frame</code> listing the values of the
variate we are interested in. In the present case the variate is
<code>species</code> and the values are ‘Adelie’, ‘Chinstrap’,
‘Gentoo’.</li>
<li>
<code>learnt</code>: the object that points to the computation made
with the <code><a href="../reference/learn.html">learn()</a></code> function, discussed in the previous
section. In the present case it’s <code>learnt10</code>.</li>
<li>Optionally, <code>parallel</code> specifies how many cores we should
use for the computation.</li>
</ul>
<p>Here is a way to call the function; the computation should take at
most a couple of seconds:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## data frame with the variate and values we want to know the frequencies of</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Adelie'</span>, <span class="st">'Chinstrap'</span>, <span class="st">'Gentoo'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Fspecies10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Pr.html">Pr</a></span><span class="op">(</span></span>
<span>    Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>    learnt <span class="op">=</span> <span class="va">learnt10</span>,</span>
<span>    parallel <span class="op">=</span> <span class="fl">4</span> <span class="co">## let's use 4 cores</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Registered doParallelSNOW with 4 workers</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Closing connections to cores.</span></span></code></pre></div>
<p>The answer to our question is now contained in the
<code>Fspecies10</code> object (we chose this name for
“<code>F</code>requency distribution of <code>species</code>, estimated
from <code>10</code> samples”). The estimate and its uncertainty can be
immediately visualized by calling <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> with this
object:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Fspecies10</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/vis10-1.png" alt="**Estimates and uncertainty of relative frequencies of penguin species**" width="100%"><p class="caption">
<strong>Estimates and uncertainty of relative frequencies of penguin
species</strong>
</p>
</div>
<p><br></p>
<p>The x-axis of this plot shows the three possible values of the
<code>species</code> variate. The y-axis reports fractions which may be
read as <em>frequencies</em> or <em>probabilities</em>.</p>
<p>The estimated frequency distribution for the species is the central,
solid red curve with small circles. (You may be used to frequency
distributions as histograms, rather than as a broken line like in the
plot above. The present visualization is more advantageous when we want
to compare several frequency distributions, as we’ll do later.)</p>
<p>The three estimated frequencies are:</p>
<ul>
<li>Adélie: 0.32</li>
<li>Chinstrap: 0.30</li>
<li>Gentoo: 0.38</li>
</ul>
<p>and can be read from the <code>values</code> element of the
<code>Fspecies10</code> object:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Fspecies10</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="co">#            X</span></span>
<span><span class="co"># Y               [,1]</span></span>
<span><span class="co">#   Adelie    0.319061</span></span>
<span><span class="co">#   Chinstrap 0.303017</span></span>
<span><span class="co">#   Gentoo    0.377922</span></span></code></pre></div>
<p>These frequency estimates have also another important meaning: they
are the <em>probabilities for the species of the next penguin we’ll
observe</em>. More generally, they are the probabilities for the next
observation. In the present context they are maybe not so relevant –
unless you’re placing bets on which data will arrive next with your
colleagues – but in other inference contexts they may be very important.
In a clinical setting, for example, where we try to infer some condition
about the next patient, these probabilities are used for clinical
decision-making; see the textbooks by Sox &amp; al. and by Hunink &amp;
al., and the paper by Lindley &amp; Novick in the <span id="referencesmedical">references</span>.</p>
<p>For the moment we focus on the “frequency estimate” meaning.</p>
<p>What about the uncertainty of these estimates?</p>
</div>
<div class="section level3">
<h3 id="uncertainty-of-estimates-credibility-intervals-and-probabilities">Uncertainty of estimates: credibility intervals and
probabilities<a class="anchor" aria-label="anchor" href="#uncertainty-of-estimates-credibility-intervals-and-probabilities"></a>
</h3>
<p>In Bayesian theory, a compact way of expressing the uncertainty in a
quantity is by means of a <strong>credibility interval</strong> with a
given probability. For instance, if we say that a particular quantity
has a 70%-credibility interval equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mn>0.41</mn><mo>,</mo><mn>0.69</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(0.41, 0.69)</annotation></semantics></math>,
what we mean is that there’s an 70% probability that the true value of
that quantity is between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.41</mn><annotation encoding="application/x-tex">0.41</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.69</mn><annotation encoding="application/x-tex">0.69</annotation></semantics></math>
– pretty straightforward! <em>Please be careful not to confuse the
Bayesian credibility interval with a “confidence interval”</em>: the
latter has a much more involved and less straightforward meaning.</p>
<p>The <code><a href="../reference/Pr.html">Pr()</a></code> function by default calculates two credibility
intervals for each frequency estimate: a 50% one, and an 89% one. In our
present inference, the 50%-credibility intervals are shown in the plot
above as the darker grey band, and the 89%-credibility intervals as the
lighter grey band. Note that these intervals contain the 50% ones.</p>
<p>For instance, the plot indicates that there’s a 50% probability that
the relative frequency of all <code>Adelie</code> penguins is roughly
between 0.23 and 0.40; and an 89% probability that their relative
frequency is roughly between 0.14 and 0.53.</p>
<p>For the <code>Gentoo</code> species, there’s a 50% probability that
its relative frequency is roughly between 0.28 and 0.47; and an 89%
probability that their relative frequency is roughly between 0.18 and
0.59.</p>
<p>We can Actually do more: we can plot the probabilities of all
possible frequencies. To understand this idea, let’s ask: what is the
relative frequency of Adélie penguins in the whole population? Possible
values could be anything between 0 and 1. But some of these values may
be more probable than others. If we look at our 10 samples, we see that
3 out of 10 are <code>Adelie</code>. So a relative frequency around 0.3
is a little more probable, although there’s still a lot of uncertainty
because this is just a small sample.</p>
<p>The <code><a href="../reference/Pr.html">Pr()</a></code> function has actually calculated the
probabilities for all possible frequencies of each species. We can plot
the probabilities of the frequencies of the <code>Adelie</code> species
as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## select only Adelie</span></span>
<span><span class="va">onlyAdelie</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Fspecies10</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">'Adelie'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">onlyAdelie</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, legend <span class="op">=</span> <span class="st">'topright'</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/hist10adelie-1.png" alt="**Probability distribution for the frequency of Adelie penguins**" width="100%"><p class="caption">
<strong>Probability distribution for the frequency of Adelie
penguins</strong>
</p>
</div>
<p><br></p>
<p>With the <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code> function we first extract from the
<code>Fspecies10</code> object only the information pertaining to the
<code>Adelie</code> species, saving it into the <code>onlyAdelie</code>
object. Then the <code><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist()</a></code> function plots the probability
distribution for all the frequency values. We see that frequencies
between around 0.2 and 0.4 have highest probability. But the probability
distribution is quite wide; even a frequency of 0.6 has some
probability. The vertical line indicates the mean of this probability
distribution, which we take as our frequency estimate and as the
probability that the next penguin we observe is of the Adélie
species.</p>
<p>The width of this probability distribution reflects our large
uncertainty, which in turn comes from the fact that we have only seen a
small sample of penguins. We shall see that this uncertainty decreases
and we gather more samples.</p>
<p><br>
The credibility intervals are calculated from the probability
distribution above. They can be quickly obtained from the
<code>quantiles</code> element of the <code>Fspecies10</code> object.
For instance, we can read the 89%-credibility intervals as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Fspecies10</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span>, , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'5.5%'</span>, <span class="st">'94.5%'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#            </span></span>
<span><span class="co"># Y               5.5%    94.5%</span></span>
<span><span class="co">#   Adelie    0.140158 0.531920</span></span>
<span><span class="co">#   Chinstrap 0.133997 0.512746</span></span>
<span><span class="co">#   Gentoo    0.183184 0.591518</span></span></code></pre></div>
<!-- As the name tells, this element actually report the *quantiles* of the probability. For example, look at the `= 25%` output: among other things it says `Adelie 0.227634`. This means that there's a 25% probability that the frequency of Adélie penguins is below $0.227634$, and thus a 75% probability that it's above $0.227634$.
 -->
</div>
<div class="section level3">
<h3 id="a-preliminary-report-on-question-q1">A preliminary report on question Q1<a class="anchor" aria-label="anchor" href="#a-preliminary-report-on-question-q1"></a>
</h3>
<p>We can now give a preliminary answer to our question
<strong>Q1</strong>, “what’s the overall statistical occurrence of the
three species in the whole population?”.</p>
<p>A summary answer could be as follows:</p>
<blockquote>
<p>From a sample of 10 penguins, the inference about the relative
frequencies of the three species in the full population is as
follows:</p>
<dl>
<dt>Adélie</dt>
<dd>
rel. frequency between 0.14 and 0.53, with 89% probability
</dd>
<dt>Chinstrap</dt>
<dd>
rel. frequency between 0.13 and 0.51, with 89% probability
</dd>
<dt>Gentoo</dt>
<dd>
rel. frequency between 0.18 and 0.59, with 89% probability
</dd>
</dl>
</blockquote>
<p>But we can also give a fuller answer by displaying the probability
distributions for all three frequencies:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">Fspecies10</span>, legend <span class="op">=</span> <span class="st">'topright'</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/hist10-1.png" alt="**Probability distribution for the rel. requencies of penguin species**" width="100%"><p class="caption">
<strong>Probability distribution for the rel. requencies of penguin
species</strong>
</p>
</div>
<p><br></p>
<p>It’s important to keep in mind that the three frequencies must add up
to 1, so if our future estimates of some of them increase, then the
estimate of some others must decrease.</p>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="prelimQ2">Analysis example: frequencies on different islands<a class="anchor" aria-label="anchor" href="#prelimQ2"></a>
</h2>
<div class="section level3">
<h3 id="estimating-frequencies-of-species-island-wise">Estimating frequencies of species, island-wise<a class="anchor" aria-label="anchor" href="#estimating-frequencies-of-species-island-wise"></a>
</h3>
<p>Let’s now do a preliminary analysis related to research question
<strong>Q2</strong>: do the three species differ, statistically, in some
physical or geographical characteristic? This question is still somewhat
vague, so let’s make it more specific: <em>Is there any difference in
species frequency on the different islands?</em></p>
<p>In other words, we want to know whether on some particular island,
one or more species appear with relative frequencies different from the
others’. It might be that all three species are equally present in each
island; or the opposite, each species might be confined in a different
island.</p>
<p>The way we proceed is analogous to the one in our <a href="#prelimQ1">first preliminary analysis</a>: we shall calculate
estimates of frequencies, their uncertainties, and even their
probability distributions. But there’s one important difference in the
present question: the frequencies we want to infer are about penguins
<em>who live on specific islands</em> – say, those who live on Biscoe.
An exact statistical answer to this question would be obtained through a
complete census of the <strong>subpopulation</strong> or
<strong>subgroup</strong> of penguins who live on Biscoe. We are
therefore speaking about a <strong>conditional frequencies</strong> and
<strong>conditional probabilities</strong>.</p>
<p>Bayesian nonparametrics and <strong><em>inferno</em></strong> can
also draw this kind of inferences. We use again the <code><a href="../reference/Pr.html">Pr()</a></code>
function, but this time we supply an additional <code>X</code> argument,
which tells which subpopulations we want to focus on. For simplicity,
let’s say that we want to focus on penguins living on Biscoe or Dream,
that is, those whose <code>island</code> variate has the values
<code>'Biscoe</code> or <code>'Dream'</code>. The code is as
follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## data frame with the variate and values of the subpopulations of interest</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>island <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Biscoe'</span>, <span class="st">'Dream'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Fspecies10I</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Pr.html">Pr</a></span><span class="op">(</span></span>
<span>    Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>    X <span class="op">=</span> <span class="va">X</span>, <span class="co">## argument for conditional inferences</span></span>
<span>    learnt <span class="op">=</span> <span class="va">learnt10</span>,</span>
<span>    parallel <span class="op">=</span> <span class="fl">4</span> <span class="co">## let's use 4 cores</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Registered doParallelSNOW with 4 workers</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Closing connections to cores.</span></span></code></pre></div>
<p>The answer to our question is now contained in the
<code>Fspecies10I</code> object (we add <code>I</code> for “island” to
the previous name). The estimates of the frequencies and their
uncertainties can again be visualized by calling
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Fspecies10I</span>, col <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/vis10I-1.png" alt="**Estimates and uncertainty of conditional frequencies**" width="100%"><p class="caption">
<strong>Estimates and uncertainty of conditional frequencies</strong>
</p>
</div>
<p><br></p>
<p>The estimated frequencies for the <code>Biscoe</code> subpopulation
are shown by the solid yellow curve with small circles; those for the
<code>Dream</code> subpopulation by the dashed purple curve with small
squares. More precise values are contained in the <code>values</code>
element of the <code>Fspecies10I</code> object:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Fspecies10I</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="co">#            X</span></span>
<span><span class="co"># Y             Biscoe    Dream</span></span>
<span><span class="co">#   Adelie    0.206050 0.335998</span></span>
<span><span class="co">#   Chinstrap 0.214225 0.423482</span></span>
<span><span class="co">#   Gentoo    0.579725 0.240520</span></span></code></pre></div>
<p>According to these estimates, on Biscoe there should be a
predominance of Gentoo penguins, with lower, roughly equal numbers of
Adélie and Chinstrap. On Dream, on the other hand, Gentoo should be the
minority, and Chinstrap should be the majority. But how sure are we
about these estimates? We see that the 89%-credibility intervals of each
frequency are quite wide. Also in this case we can get a better picture
by displaying the probability distribution of each frequency, by means
of the <code><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist()</a></code> function, and see how much they overlap.</p>
<p>For Biscoe island we find</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## select only Biscoe</span></span>
<span><span class="va">onlyBiscoe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Fspecies10I</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>island <span class="op">=</span> <span class="st">'Biscoe'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">onlyBiscoe</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, legend <span class="op">=</span> <span class="st">'topright'</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/hist10biscoe-1.png" alt="**Probability distribution for species frequencies on Biscoe**" width="100%"><p class="caption">
<strong>Probability distribution for species frequencies on
Biscoe</strong>
</p>
</div>
<p>Note how, according to these preliminary estimates, the frequencies
of Adélie and Chinstrap are very close, around 0.2, and quite different
from the frequency of Gentoo, around 0.58. Yet, the probability
distributions are wide; each distribution gives a non-zero probability
to all three estimates.</p>
<p><strong>For later, keep in mind the following question: <em>On
Biscoe, are the frequencies of Adélie and Chinstrap
different?</em></strong> The present estimates show almost no
difference, but we are warned about a large uncertainty. Will more
sampling data confirm “no difference”?</p>
<p><br>
For Dream island we find</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## select only Dream</span></span>
<span><span class="va">onlyDream</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Fspecies10I</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>island <span class="op">=</span> <span class="st">'Dream'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">onlyDream</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, legend <span class="op">=</span> <span class="st">'topright'</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/hist10dream-1.png" alt="**Probability distribution for species frequencies on Biscoe**" width="100%"><p class="caption">
<strong>Probability distribution for species frequencies on
Biscoe</strong>
</p>
</div>
<p><br></p>
<p>Among other things we see here a larger difference in the estimated
frequencies of Adélie, around 0.34, and Chinstrap, around 0.42. Still,
the probability distributions are wide.</p>
<p><strong>For later, keep in mind the following question: <em>On Dream,
are the frequencies of Adélie and Chinstrap different?</em></strong> The
present estimates show a difference, but with large uncertainty. Will
more sampling data confirm “difference”?</p>
</div>
<div class="section level3">
<h3 id="a-preliminary-report-on-question-q2">A preliminary report on question Q2<a class="anchor" aria-label="anchor" href="#a-preliminary-report-on-question-q2"></a>
</h3>
<p>The last two plots are a visual answer to our research question: “is
there any difference in species frequency on the different islands?”,
restricted to Biscoe and Dream islands. This answer does not only give
estimates, but full probability distributions showing their
uncertainties.</p>
<p>A more compact summary can again be given with credibility intervals.
We can produce it as follows:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/aperm.html" class="external-link">aperm</a></span><span class="op">(</span></span>
<span>    <span class="va">Fspecies10I</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span>, , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'5.5%'</span>, <span class="st">'94.5%'</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co">## change order for better display</span></span>
<span><span class="co"># , , X = Biscoe</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#            </span></span>
<span><span class="co"># Y                5.5%    94.5%</span></span>
<span><span class="co">#   Adelie    0.0376968 0.466033</span></span>
<span><span class="co">#   Chinstrap 0.0384570 0.469123</span></span>
<span><span class="co">#   Gentoo    0.2798207 0.854380</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># , , X = Dream</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#            </span></span>
<span><span class="co"># Y                5.5%    94.5%</span></span>
<span><span class="co">#   Adelie    0.1033126 0.623346</span></span>
<span><span class="co">#   Chinstrap 0.1654065 0.716321</span></span>
<span><span class="co">#   Gentoo    0.0556945 0.506120</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="nht">Differences from “null-hypothesis testing” and <em>p</em>-value
methods<a class="anchor" aria-label="anchor" href="#nht"></a>
</h3>
<p>The reason I asked you to keep in mind the two “frequencies
different?” questions is that they will demonstrate important
differences between Bayesian nonparametrics and methods based on
“null-hypothesis testing” and on <em>p</em>-values.</p>
<p>Null-hypothesis testing focuses on trying to answer whether a
hypothesis of “equality” is false. An important problem of this approach
is that “equality” or “difference” are fuzzy notions. Are the two
frequencies 0.35 and 0.40 equal or different? What about 0.39 and 0.40?
And what about 0.3999 and 0.4000? Whether two numbers can be considered
equal or different depends on a choice of tolerance level, which in turn
depends on the context and application. In some cases, frequencies of
0.3 and 0.4 might be considered practically equal; in others,
frequencies of 0.39 and 0.40 might be considered very different. The
ambiguity about the intended tolerance in null-hypothesis testing is one
of the aspects that make “p-hacking” possible: even frequencies as close
as 0.3999 and 0.4000 will lead to some difference in enough large
samples.</p>
<p>The Bayesian approach resists this context-dependent and even
subjective simplification. Instead it focuses on giving <em>numerical
values</em> and their uncertainties. A frequency can be said to be
between 0.38 and 0.39 with 90% probability; another to be between 0.40
and 0.43 with 90% probability. You can then decide whether this
separation and its uncertainty are enough for you, or whether you want
to get more stringent bounds by collecting more samples.</p>
<p><br></p>
<p>One problem with <em>p</em>-values is that if you re-calculate them
anew, as new samples arrive, sooner or later you can reach as low a
<em>p</em>-value as desired. This procedure is called “optional
stopping” and is a form of “<em>p</em>-hacking”. This is why in using
methods based on <em>p</em>-values you must <em>beforehand</em> declare
your sample size or at least a precise stopping rule.</p>
<p>Bayesian estimates don’t suffer from this problem. You can update the
estimates and their uncertainties as new samples arrive. What happens is
that the uncertainties decrease, and the estimates converge to their
true values. This feature keeps you safe and gives you greater
flexibility in designing your experiments and in changing strategies
along the way. We demonstrate this in the next section.</p>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="more-samples">More samples<a class="anchor" aria-label="anchor" href="#more-samples"></a>
</h2>
<div class="section level3">
<h3 id="updating-what-weve-learnt">Updating what we’ve learnt<a class="anchor" aria-label="anchor" href="#updating-what-weve-learnt"></a>
</h3>
<p>The preliminary analysis based on only 10 samples of penguins
revealed possible interesting hypotheses, for instance that the relative
frequencies of Adélie and Chinstrap penguins are both around 0.2 on
Biscoe island, and differ by 10% or more apart on Dream island. But the
analysis and hypotheses had very large uncertainties.</p>
<p>Now imagine that our sampling colleagues send us 50 more datapoints,
which we add to the 10 we already have. Let’s store the 60 datapoints in
the file <code>'penguin_data60.csv'</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datafile</span> <span class="op">&lt;-</span> <span class="st">'penguin_data60.csv'</span></span>
<span><span class="fu"><a href="../reference/inferno.data.html">write.csvi</a></span><span class="op">(</span><span class="va">penguin</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span>, <span class="op">]</span>, <span class="va">datafile</span><span class="op">)</span> <span class="co">## write the first 60 samples</span></span></code></pre></div>
<p>Feel free to take a look at your extended sample data. There may be
new datapoints with missing values, but as already discussed this isn’t
a problem for Bayesian theory and <strong><em>inferno</em></strong>.</p>
<p>Let’s now update our inferences with the new sampled data. This is
done again with the <code><a href="../reference/learn.html">learn()</a></code> function. <em>Please wait
before running this code</em>, it might take longer time on your
computer:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">learnt60</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/learn.html">learn</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">datafile</span>,</span>
<span>    metadata <span class="op">=</span> <span class="va">metadatafile</span>,</span>
<span>    outputdir <span class="op">=</span> <span class="st">'penguin_inference'</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    parallel <span class="op">=</span> <span class="fl">4</span> <span class="co">## how many cores to use for the computation</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Registered doParallelSNOW with 4 workers</span></span>
<span><span class="co"># Calculating auxiliary metadata</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Learning:  60 datapoints,  8 variates</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#  *************************************************** </span></span>
<span><span class="co">#  Saving output in directory</span></span>
<span><span class="co">#  penguin_inference-261031T122341-vrt8_dat60_smp3600 </span></span>
<span><span class="co">#  *************************************************** </span></span>
<span><span class="co"># Starting Monte Carlo sampling of 3600 samples by 60 chains</span></span>
<span><span class="co"># in a space of 1027 (effectively 16651) dimensions.</span></span>
<span><span class="co"># Using 4 cores: 60 samples per chain, max 15 chains per core.</span></span>
<span><span class="co"># Core logs are being saved in individual files.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># C-compiling samplers appropriate to the variates (package Nimble)</span></span>
<span><span class="co"># this can take tens of minutes. Please wait...</span></span>
<span><span class="co"># Compiled core 1. Number of samplers: 1328.       </span></span>
<span><span class="co"># Estimating remaining time, please be patient...</span></span>
<span><span class="co"># Sampling. Core 1 estimated end time: 2026-10-31 12:39</span></span>
<span><span class="co"># Finished Monte Carlo sampling.                                 </span></span>
<span><span class="co"># Highest number of Monte Carlo iterations across chains: 14235 </span></span>
<span><span class="co"># Highest number of used mixture components: 19 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Checking test data</span></span>
<span><span class="co"># ( #8 #15 #20 #27 #30 #33 #43 #46 #59 )</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># rel. MC standard error: min: 0.03  max: 0.064  mean: 0.045 </span></span>
<span><span class="co"># eff. sample size: min: 250  max: 1100  mean: 580 </span></span>
<span><span class="co"># needed thinning: min: 5  max: 22  mean: 12 </span></span>
<span><span class="co"># average: min: 4.9e-09  max: 3.8e-08  mean: 1.6e-08 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Plotting final Monte Carlo traces and marginal samples...</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Total computation time: 12 mins </span></span>
<span><span class="co"># Average preparation &amp; finalization time: 1.2 mins </span></span>
<span><span class="co"># Average Monte Carlo time per chain: 40 secs </span></span>
<span><span class="co"># Max total memory used: approx 3600 MB</span></span>
<span><span class="co"># Max memory used per core: approx 950 MB</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Removing temporary output files.</span></span>
<span><span class="co"># Finished.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Closing connections to cores.</span></span></code></pre></div>
<p>The calculation with 60 sample data took around 4 GB and 12 minutes
on 4 cores.</p>
<p>The results of this updated inference are now stored in the
compressed file <code>'learnt.rds'</code> within the new output
directory. For your convenience the object produced by the computation
above can be downloaded as the file <a href="https://github.com/pglpm/inferno/raw/main/development/downloads/learnt60.rds" class="external-link"><code>'learnt60.rds'</code></a>.
Once you have downloaded it in your working directory, invoke</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">learnt60</span> <span class="op">&lt;-</span> <span class="st">'learnt60.rds'</span></span></code></pre></div>
<p>which we now use to update our analysis.</p>
</div>
<div class="section level3">
<h3 id="updates-in-analysis-and-hypotheses">Updates in analysis and hypotheses<a class="anchor" aria-label="anchor" href="#updates-in-analysis-and-hypotheses"></a>
</h3>
<p>In our preliminary analysis we focused on three questions:</p>
<ul>
<li><em>What’s the overall statistical occurrence of the three species
in the whole population?</em></li>
<li><em>What’s the difference between Adélies and Chinstrap frequencies
on Biscoe island?</em></li>
<li><em>What’s the difference between Adélies and Chinstrap frequencies
on Dream island?</em></li>
</ul>
<p>We can update our answers – frequency estimates, their credible
intervals, and their probability distributions – from the increased data
sample, using the <code><a href="../reference/Pr.html">Pr()</a></code> function <a href="#learningfirst">as
before</a>. Note that in the <code>learnt =</code> argument we must now
use the new <code>learnt60</code> object, which points to the updated
inference. Here is the calculation for all three questions:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 'Y' and 'X' were previously defined with:</span></span>
<span><span class="co">## Y &lt;- data.frame(species = c('Adelie', 'Chinstrap', 'Gentoo'))</span></span>
<span><span class="co">## X &lt;- data.frame(island = c('Biscoe', 'Dream'))</span></span>
<span></span>
<span><span class="va">Fspecies60</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Pr.html">Pr</a></span><span class="op">(</span></span>
<span>    Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>    learnt <span class="op">=</span> <span class="va">learnt60</span>, <span class="co">## updated inference</span></span>
<span>    parallel <span class="op">=</span> <span class="fl">4</span> <span class="co">## let's use 4 cores</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Registered doParallelSNOW with 4 workers</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Closing connections to cores.</span></span>
<span></span>
<span><span class="va">Fspecies60I</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Pr.html">Pr</a></span><span class="op">(</span></span>
<span>    Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>    X <span class="op">=</span> <span class="va">X</span>, <span class="co">## argument for conditional inferences</span></span>
<span>    learnt <span class="op">=</span> <span class="va">learnt60</span>, <span class="co">## updated inference</span></span>
<span>    parallel <span class="op">=</span> <span class="fl">4</span> <span class="co">## let's use 4 cores</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Registered doParallelSNOW with 4 workers</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Closing connections to cores.</span></span></code></pre></div>
<p>Just like in the preliminary analysis we can use the
<code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> and <code><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist()</a></code> functions to visualize
estimates, credibility intervals, and probability distributions.</p>
<p><br>
Consider the first question: overall statistical occurrence of the three
species. Let’s plot the new estimates and their credibility
intervals:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Fspecies60</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/vis60-1.png" alt="**Updated frequency estimates of penguin species**" width="100%"><p class="caption">
<strong>Updated frequency estimates of penguin species</strong>
</p>
</div>
<p><br></p>
<p>You may notice that the credibility intervals are now narrower,
compared to those of the previous estimates. Let’s actually overlap the
plots of the initial and updated inferences, to better see how they got
updated:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## find common y-maximum for correct visual comparison</span></span>
<span><span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Fspecies10</span><span class="op">$</span><span class="va">quantiles</span>, <span class="va">Fspecies60</span><span class="op">$</span><span class="va">quantiles</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Fspecies10</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">ymax</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">3</span>, pch <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">## distinguish the two plots</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Fspecies60</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">ymax</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span>, pch <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co">## distinguish the two plots</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">'top'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'10 samples'</span>, <span class="st">'60 samples'</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">1</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">1</span>, pch <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">1</span>, bty <span class="op">=</span> <span class="st">'n'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/vis60compare-1.png" width="100%"></p>
<p>We notice the following differences, among others:</p>
<ul>
<li><p>The new frequency estimates (circles) for <code>Adelie</code> and
<code>Chinstrap</code> differ by almost 10% from the previous ones
(triangles). The estimate for <code>Gentoo</code> is almost the
same.</p></li>
<li><p>The new credibility intervals (grey bands) are narrower than the
previous ones (red bands).</p></li>
<li>
<p>All new estimates (circles) are almost or fully within the
50%-credibility intervals of the previous estimates (darker-red bands).
All new estimates are fully within the previous 89%-credibility
intervals (lighter-red bands).</p>
<p>These changes are consistent with the meaning of the credibility
intervals: one every two estimates can end outside the 50%-credibility
interval, and 1 out of 10 can end outside the 89%-credibility
interval.</p>
</li>
</ul>
<!-- These observations demonstrate the [features previously discussed](#nht): as the sample size increases, the uncertainty decreases, but without leading to spurious "effects". --><p>We can also plot the updated probability distributions for the
relative frequencies of the three species. Let’s plot them together with
the previous ones to highlight the changes:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">Fspecies60</span>, legend <span class="op">=</span> <span class="st">'topright'</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, main <span class="op">=</span> <span class="st">'60 samples'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/hist60-1.png" width="100%"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">Fspecies10</span>, legend <span class="op">=</span> <span class="st">'topright'</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">'usr'</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, <span class="co">## y-range from previous plot</span></span>
<span>    col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, main <span class="op">=</span> <span class="st">'10 samples'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/hist60-2.png" width="100%"></p>
<p>We see that in our initial inference (bottom plot) all three
probability distributions largely overlapped, indicating our uncertainty
on whether any of these frequencies might be very different from the
others.</p>
<p>In our updated inference (top plot) there is still a large overlap
for the probabilities of <code>Adelie</code> (solid red curve) and
<code>Gentoo</code> (dot-dashed green curve) frequencies, indicating
that we’re still very uncertain on whether these frequencies might be
very different or not – we need more sample to resolve this. But we can
already conclude, with high probability, that their difference won’t be
larger than around 30% (the width of their distributions).</p>
<p>But the probability distribution for the <code>Chinstrap</code>
frequency (dashed blue curve) has now a smaller overlap with the other
two: there’s an increased probability that this frequency is around 20%
different from at least one of the other two. Later on we shall see how
to calculate these probabilities exactly.</p>
<p>Our updated quantitative answer to the question “<em>What’s the
overall statistical occurrence of the three species in the whole
population?</em>” is as follows:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Fspecies60</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span>, , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'5.5%'</span>, <span class="st">'94.5%'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#            </span></span>
<span><span class="co"># Y               5.5%    94.5%</span></span>
<span><span class="co">#   Adelie    0.296274 0.483736</span></span>
<span><span class="co">#   Chinstrap 0.138085 0.297815</span></span>
<span><span class="co">#   Gentoo    0.304430 0.499396</span></span></code></pre></div>
<blockquote>
<p>From a sample of 10 penguins, the inference about the relative
frequencies of the three species in the full population is as
follows:</p>
<dl>
<dt>Adélie</dt>
<dd>
rel. frequency between 0.29 and 0.49, with 89% probability
</dd>
<dt>Chinstrap</dt>
<dd>
rel. frequency between 0.14 and 0.30, with 89% probability
</dd>
<dt>Gentoo</dt>
<dd>
rel. frequency between 0.30 and 0.50, with 89% probability
</dd>
</dl>
</blockquote>
</div>
<div class="section level3">
<h3 id="updates-in-island-wise-conditional-frequencies-a-surprising-result">Updates in island-wise conditional frequencies: a surprising
result<a class="anchor" aria-label="anchor" href="#updates-in-island-wise-conditional-frequencies-a-surprising-result"></a>
</h3>
<p>We can quickly repeat the analysis above for the <em>conditional</em>
frequencies on the <code>Biscoe</code> and <code>Dream</code> islands,
that is, the frequencies for the two subpopulations of penguins living
on those two islands. Let’s directly plot the probability distributions
for the two subpopulation frequencies, together with those from the
previous inference.</p>
<p><br>
For <code>Dream</code> island:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## select only Dream</span></span>
<span><span class="va">onlyDream10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Fspecies10I</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>island <span class="op">=</span> <span class="st">'Dream'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">onlyDream60</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Fspecies60I</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>island <span class="op">=</span> <span class="st">'Dream'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">onlyDream60</span>, legend <span class="op">=</span> <span class="st">'topright'</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, main <span class="op">=</span> <span class="st">'60 samples, Dream island'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/hist60Dream-1.png" width="100%"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">onlyDream10</span>, legend <span class="op">=</span> <span class="st">'topright'</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">'usr'</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, <span class="co">## y-range from previous plot</span></span>
<span>    col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, main <span class="op">=</span> <span class="st">'10 samples, Dream island'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/hist60Dream-2.png" width="100%"></p>
<p>The new frequency estimates for <code>Adelies</code> (solid red line)
and <code>Chinstrap</code> (dashed blue line) are now less than 10%
apart, whereas the previous estimates had them 20% apart. But this
change is not unexpected: these new estimates are well within the
previous credibility intervals; we were correctly warned about their
possible change.</p>
<p><br>
For <code>Biscoe</code> island:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## select only Biscoe</span></span>
<span><span class="va">onlyBiscoe10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Fspecies10I</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>island <span class="op">=</span> <span class="st">'Biscoe'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">onlyBiscoe60</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Fspecies60I</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>island <span class="op">=</span> <span class="st">'Biscoe'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">onlyBiscoe60</span>, legend <span class="op">=</span> <span class="st">'topright'</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, main <span class="op">=</span> <span class="st">'60 samples, Biscoe island'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/hist60Biscoe-1.png" width="100%"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">onlyBiscoe10</span>, legend <span class="op">=</span> <span class="st">'topright'</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">'usr'</span><span class="op">)</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>, <span class="co">## y-range from previous plot</span></span>
<span>    col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, main <span class="op">=</span> <span class="st">'10 samples, Biscoe island'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/hist60Biscoe-2.png" width="100%"></p>
<p>The new frequency estimates for <code>Adelies</code> (solid red line)
and <code>Chinstrap</code> (dashed blue line) are now 10% apart, whereas
the previous estimates were almost equal. Again this is not unexpected,
and these changes are well within the previous credibility
intervals.</p>
<p>Notably, we see now a clear separation between the probability
distribution for the frequency of <code>Gentoo</code> (dot-dashed
green), and that for <code>Chinstrap</code> (dashed blue). This means
that these two frequencies must be clearly different. Can we quantify
how different, and with which uncertainty?</p>
<p>Yes, this can be calculated and visualized as follows:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">freqdiff</span> <span class="op">&lt;-</span> <span class="va">Fspecies60I</span><span class="op">$</span><span class="va">samples</span><span class="op">[</span><span class="st">'Gentoo'</span>, <span class="st">'Biscoe'</span>,<span class="op">]</span> <span class="op">-</span></span>
<span>    <span class="va">Fspecies60I</span><span class="op">$</span><span class="va">samples</span><span class="op">[</span><span class="st">'Chinstrap'</span>, <span class="st">'Biscoe'</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">freqdiff</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">'frequency difference'</span>, ylab <span class="op">=</span> <span class="st">'probability density'</span>,</span>
<span>    main <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/probdifference-1.png" alt="**probability of frequency difference between Gentoo and Chinstrap**" width="100%"><p class="caption">
<strong>probability of frequency difference between Gentoo and
Chinstrap</strong>
</p>
</div>
<p>Clearly there’s a high probability that <code>Gentoo</code> frequency
is larger than <code>Chinstrap</code> frequency, on <code>Biscoe</code>
island. We can report an estimate and uncertainty about this
difference:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">freqdiff</span><span class="op">)</span></span>
<span><span class="co"># [1] 0.592298</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">freqdiff</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#      50%      95% </span></span>
<span><span class="co"># 0.592298 0.755933</span></span></code></pre></div>
<blockquote>
<p>From a sample of 60 penguins, the difference between the frequencies
of <code>Gentoo</code> species and <code>Chinstrap</code> species, on
<code>Biscoe</code> island, is estimated with a median of 0.59, and it
is between 0.59 and 0.76 with 90% probability.</p>
</blockquote>
<p>Maybe you prefer a ratio between the two frequencies:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">freqratio</span> <span class="op">&lt;-</span> <span class="va">Fspecies60I</span><span class="op">$</span><span class="va">samples</span><span class="op">[</span><span class="st">'Gentoo'</span>, <span class="st">'Biscoe'</span>,<span class="op">]</span> <span class="op">/</span></span>
<span>    <span class="va">Fspecies60I</span><span class="op">$</span><span class="va">samples</span><span class="op">[</span><span class="st">'Chinstrap'</span>, <span class="st">'Biscoe'</span>,<span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">freqratio</span><span class="op">)</span></span>
<span><span class="co"># [1] 7.66448</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">freqratio</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#      5%     95% </span></span>
<span><span class="co">#  3.2617 22.8390</span></span></code></pre></div>
<blockquote>
<p>From a sample of 60 penguins, the ratio between the frequencies of
<code>Gentoo</code> species on <code>Chinstrap</code> species, on
<code>Biscoe</code> island, is estimated with a median of 7.7, and it is
between 3.26 and 22.84 with 90% probability.</p>
</blockquote>
<p>It is remarkable that with only 60 penguins (and not all of them from
Biscoe island) we can conclude with a high probability (95%) that there
are at least 3 times more Gentoo than Chinstrap penguins on Biscoe
island!</p>
<p><br><strong>If your only research question had been to check whether the
Gentoo population is at least twice as large as Chinstrap’s on Biscoe
island, you could have stopped sampling now and report your
results.</strong></p>
<p>By contrast, with a null-hypothesis test based on <em>p</em>-values,
if you had planned beforehand to examine 300 penguins, you could not
state such results before all 300 penguins were collected. And your
results would be less clearly interpretable than the ones above.</p>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="final-inferences">Final inferences<a class="anchor" aria-label="anchor" href="#final-inferences"></a>
</h2>
<div class="section level3">
<h3 id="when-the-sampling-is-finished">When the sampling is finished<a class="anchor" aria-label="anchor" href="#when-the-sampling-is-finished"></a>
</h3>
<p>Let’s emphasize again an important feature of Bayesian inference: you
can monitor your estimates and their uncertainty while the data samples
arrive. And if you reach uncertainties about your hypotheses that you
deem low enough, you can stop sampling and report your findings and
their probabilities.</p>
<p>With 60 data samples, we consider our uncertainties about our
research questions <strong>Q1</strong> and <strong>Q2</strong> still too
large – except for an important result about Gentoo and Chinstrap
species on Biscoe island, which we can already announce. Let’s suppose
that we continued sampling; our colleagues sent us 284 more data
samples, for a total of 344 with the ones previously sent. The sampling
then stopped, so this is all the data we have to report our final
findings and their uncertainty.</p>
<p>Let’s store all datapoints in the file
<code>'penguin_data.csv'</code>:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datafile</span> <span class="op">&lt;-</span> <span class="st">'penguin_data.csv'</span></span>
<span><span class="fu"><a href="../reference/inferno.data.html">write.csvi</a></span><span class="op">(</span><span class="va">penguin</span>, <span class="va">datafile</span><span class="op">)</span> <span class="co">## write the first 60 samples</span></span></code></pre></div>
<p>As usual we perform the updated inference with the
<code><a href="../reference/learn.html">learn()</a></code> function (and as usual please wait before running
the code below):</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">learntall</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/learn.html">learn</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">datafile</span>,</span>
<span>    metadata <span class="op">=</span> <span class="va">metadatafile</span>,</span>
<span>    outputdir <span class="op">=</span> <span class="st">'penguin_inference'</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    parallel <span class="op">=</span> <span class="fl">4</span> <span class="co">## how many cores to use for the computation</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Registered doParallelSNOW with 4 workers</span></span>
<span><span class="co"># Calculating auxiliary metadata</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Learning:  344 datapoints,  8 variates</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#  ****************************************************** </span></span>
<span><span class="co">#  Saving output in directory</span></span>
<span><span class="co">#  penguin_inference-261031T122345-vrt8_dat344_smp3600 </span></span>
<span><span class="co">#  ****************************************************** </span></span>
<span><span class="co"># Starting Monte Carlo sampling of 3600 samples by 60 chains</span></span>
<span><span class="co"># in a space of 1027 (effectively 89368) dimensions.</span></span>
<span><span class="co"># Using 4 cores: 60 samples per chain, max 15 chains per core.</span></span>
<span><span class="co"># Core logs are being saved in individual files.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># C-compiling samplers appropriate to the variates (package Nimble)</span></span>
<span><span class="co"># this can take tens of minutes. Please wait...</span></span>
<span><span class="co"># Compiled core 1. Number of samplers: 2757.       </span></span>
<span><span class="co"># Estimating remaining time, please be patient...</span></span>
<span><span class="co"># Sampling. Core 2 estimated end time: 2026-10-31 12:14</span></span>
<span><span class="co"># Finished Monte Carlo sampling.                                 </span></span>
<span><span class="co"># Highest number of Monte Carlo iterations across chains: 22364 </span></span>
<span><span class="co"># Highest number of used mixture components: 33 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Checking test data</span></span>
<span><span class="co"># ( #64 #125 #127 #189 #225 #264 #271 #276 #315 )</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># rel. MC standard error: min: 0.065  max: 0.11  mean: 0.089 </span></span>
<span><span class="co"># eff. sample size: min: 88  max: 240  mean: 130 </span></span>
<span><span class="co"># needed thinning: min: 23  max: 62  mean: 44 </span></span>
<span><span class="co"># average: min: 3.8e-09  max: 1.2e-07  mean: 3.1e-08 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Plotting final Monte Carlo traces and marginal samples...</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Total computation time: 46 mins </span></span>
<span><span class="co"># Average preparation &amp; finalization time: 3.2 mins </span></span>
<span><span class="co"># Average Monte Carlo time per chain: 2.7 mins </span></span>
<span><span class="co"># Max total memory used: approx 3800 MB</span></span>
<span><span class="co"># Max memory used per core: approx 990 MB</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Removing temporary output files.</span></span>
<span><span class="co"># Finished.</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Closing connections to cores.</span></span></code></pre></div>
<p>The calculation with 344 sample data took around 4 GB and 46 minutes
on 4 cores.</p>
<p>The results of this final inference are stored in the compressed file
<code>'learnt.rds'</code> within the new output directory. The object
produced by the computation above can be downloaded as the file <a href="https://github.com/pglpm/inferno/raw/main/development/downloads/learntall.rds" class="external-link"><code>'learntall.rds'</code></a>.
Once you have downloaded it in your working directory, invoke</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">learntall</span> <span class="op">&lt;-</span> <span class="st">'learntall.rds'</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="final-results-on-overall-species-frequencies">Final results on overall species frequencies<a class="anchor" aria-label="anchor" href="#final-results-on-overall-species-frequencies"></a>
</h3>
<p>Our final results about the overall relative frequencies of the three
species are computed in the usual way:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 'Y' and 'X' were previously defined with:</span></span>
<span><span class="co">## Y &lt;- data.frame(species = c('Adelie', 'Chinstrap', 'Gentoo'))</span></span>
<span></span>
<span><span class="va">Fspeciesall</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Pr.html">Pr</a></span><span class="op">(</span></span>
<span>    Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>    learnt <span class="op">=</span> <span class="va">learntall</span>, <span class="co">## updated inference</span></span>
<span>    parallel <span class="op">=</span> <span class="fl">4</span> <span class="co">## let's use 4 cores</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Registered doParallelSNOW with 4 workers</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Closing connections to cores.</span></span></code></pre></div>
<p>Let’s plot the estimated frequencies with their credibility
intervals, and also their probability distributions:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Fspeciesall</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/visall-1.png" width="100%"></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">Fspeciesall</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, legend <span class="op">=</span> <span class="st">'topright'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/visall-2.png" width="100%"></p>
<p>The last plot is visually the most complete answer we can give to our
research question <strong>Q1</strong>: “<em>What’s the overall
statistical occurrence of the three species in the whole
population?</em>”. A quantitative summary can be extracted from the
<code>Fspeciesall</code> in the usual way:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Fspeciesall</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="co">#            X</span></span>
<span><span class="co"># Y               [,1]</span></span>
<span><span class="co">#   Adelie    0.435596</span></span>
<span><span class="co">#   Chinstrap 0.199464</span></span>
<span><span class="co">#   Gentoo    0.364940</span></span>
<span></span>
<span><span class="va">Fspeciesall</span><span class="op">$</span><span class="va">quantiles</span><span class="op">[</span>, , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'5.5%'</span>, <span class="st">'94.5%'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#            </span></span>
<span><span class="co"># Y               5.5%    94.5%</span></span>
<span><span class="co">#   Adelie    0.395305 0.477901</span></span>
<span><span class="co">#   Chinstrap 0.166135 0.234447</span></span>
<span><span class="co">#   Gentoo    0.324735 0.406359</span></span></code></pre></div>
<blockquote>
<p>From a sample of 344 penguins [add a more thorough specification of
population and sampling procedure here], the relative frequencies of the
three species in the full population are estimated as follows (obviously
the three estimates and uncertainties are not independent, because the
frequencies must add up to 1):</p>
<dl>
<dt>Adélie</dt>
<dd>
estimate 0.44 <br>true rel. frequency between 0.40 and 0.48 with 89%
probability
</dd>
<dt>Chinstrap</dt>
<dd>
estimate 0.20 <br>true rel. frequency between 0.17 and 0.23 with 89%
probability
</dd>
<dt>Gentoo</dt>
<dd>
estimate 0.36 <br>true rel. frequency between 0.32 and 0.41 with 89%
probability
</dd>
</dl>
</blockquote>
</div>
<div class="section level3">
<h3 id="statistical-differences-in-subpopulations">Statistical differences in subpopulations<a class="anchor" aria-label="anchor" href="#statistical-differences-in-subpopulations"></a>
</h3>
<p>Our research question <strong>Q2</strong>, “Do the species differ,
statistically, in some physical or geographical characteristic?”, can
lead to many diverse analyses. We are essentially asking about frequency
estimates of some variates in particular subpopulations; for instance
frequencies of the three species among penguins living in one or another
island. These kinds of inference are straightforward with Bayesian
theory and <strong><em>inferno</em></strong>. As examples partly
different from the previous ones, let’s focus on these three:</p>
<ul>
<li>
<strong>Q2a</strong> <em>What are the relative frequencies of the
three species, on Biscoe island?</em> We can therefore check whether our
strong results from 60 samples are confirmed by the new samples.</li>
<li>
<strong>Q2b</strong> <em>What’s the distribution of Adélie penguins
among the three islands?</em> Note that the subpopulation in this
question is a particular species, rather than a particular island.</li>
<li>
<strong>Q2c</strong> <em>What’s the frequency distribution of body
mass in the three species?</em>
</li>
</ul>
<p>Each question can be answered by means of the <code><a href="../reference/Pr.html">Pr()</a></code>
function, and visualized with the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> or
<code><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist()</a></code> functions. Let’s see them one by one. We shall write
our code in a way that can be easily adapted from one analysis to the
other.</p>
<div class="section level4">
<h4 id="q2a-species-on-biscoe">
<strong>Q2a</strong>: species on Biscoe<a class="anchor" aria-label="anchor" href="#q2a-species-on-biscoe"></a>
</h4>
<p>We define an object <code>Y</code> for the variate we want to know
the frequency about, and an object <code>X</code> for the
<em>subpopulation</em> we’re restricting our analysis to:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Yvrt</span> <span class="op">&lt;-</span> <span class="st">'species'</span> <span class="co">## variate of interest</span></span>
<span><span class="va">Yvls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">penguin</span><span class="op">[</span>, <span class="va">Yvrt</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co">## values from dataset</span></span>
<span><span class="co">## build Y object</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Yvls</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Yvrt</span></span>
<span></span>
<span><span class="va">Xvrt</span> <span class="op">&lt;-</span> <span class="st">'island'</span> <span class="co">## subpopulation variate</span></span>
<span><span class="va">Xvls</span> <span class="op">&lt;-</span> <span class="st">'Biscoe'</span> <span class="co">## subpopulation value</span></span>
<span><span class="co">## build X object</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Xvls</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Xvrt</span></span>
<span></span>
<span><span class="va">Fanalysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Pr.html">Pr</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, learnt <span class="op">=</span> <span class="va">learntall</span>, parallel <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Registered doParallelSNOW with 4 workers</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Closing connections to cores.</span></span></code></pre></div>
<p>Here are the probability distributions for the three frequencies:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">Fanalysis</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, <span class="co">## same colours as before!</span></span>
<span>    legend <span class="op">=</span> <span class="st">'topright'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-8-1.png" width="100%"></p>
<blockquote>
<p>From a sample of 344 penguins, the relative frequencies of the three
species <strong>on Biscoe island</strong> are estimated as follows:</p>
<dl>
<dt>Adélie</dt>
<dd>
estimate 0.26 <br>true rel. frequency between 0.21 and 0.31 with 89%
probability
</dd>
<dt>Chinstrap</dt>
<dd>
estimate 0.04 <br>true rel. frequency between 0.02 and 0.06 with 89%
probability
</dd>
<dt>Gentoo</dt>
<dd>
estimate 0.70 <br>true rel. frequency between 0.65 and 0.76 with 89%
probability
</dd>
</dl>
</blockquote>
<p>Note how our previous estimates from 60 samples were already quite on
the spot.</p>
</div>
<div class="section level4">
<h4 id="q2b-adélie-on-three-islands">
<strong>Q2b</strong>: Adélie on three islands<a class="anchor" aria-label="anchor" href="#q2b-ad%C3%A9lie-on-three-islands"></a>
</h4>
<p>In this case, <code>Adelie</code> penguins are our subpopulation:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Yvrt</span> <span class="op">&lt;-</span> <span class="st">'island'</span> <span class="co">## variate of interest</span></span>
<span><span class="va">Yvls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">penguin</span><span class="op">[</span>, <span class="va">Yvrt</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co">## values from dataset</span></span>
<span><span class="co">## build Y object</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Yvls</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Yvrt</span></span>
<span></span>
<span><span class="va">Xvrt</span> <span class="op">&lt;-</span> <span class="st">'species'</span> <span class="co">## subpopulation variate</span></span>
<span><span class="va">Xvls</span> <span class="op">&lt;-</span> <span class="st">'Adelie'</span> <span class="co">## subpopulation value</span></span>
<span><span class="co">## build X object</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Xvls</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Xvrt</span></span>
<span></span>
<span><span class="va">Fanalysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Pr.html">Pr</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, learnt <span class="op">=</span> <span class="va">learntall</span>, parallel <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Registered doParallelSNOW with 4 workers</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Closing connections to cores.</span></span></code></pre></div>
<p>Here are the probability distributions for the three frequencies:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">Fanalysis</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">7</span>,</span>
<span>    legend <span class="op">=</span> <span class="st">'topright'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-9-1.png" width="100%"></p>
<blockquote>
<p>From a sample of 344 penguins, the distribution of the
<strong>Adélies</strong> species on the three islands is estimated as
follows:</p>
<dl>
<dt>Biscoe</dt>
<dd>
estimate 0.29 <br>true rel. frequency between 0.23 and 0.35 with 89%
probability
</dd>
<dt>Dream</dt>
<dd>
estimate 0.39 <br>true rel. frequency between 0.32 and 0.45 with 89%
probability
</dd>
<dt>Torgersen</dt>
<dd>
estimate 0.32 <br>true rel. frequency between 0.26 and 0.38 with 89%
probability
</dd>
</dl>
</blockquote>
<p>Note that in this case our uncertainties do <em>not</em> allow us to
exclude the possibility that Adélies penguins are roughly equally
distributed on the three islands.</p>
</div>
<div class="section level4">
<h4 id="q2c-body-mass-across-the-three-species">
<strong>Q2c</strong>: Body mass across the three species<a class="anchor" aria-label="anchor" href="#q2c-body-mass-across-the-three-species"></a>
</h4>
<p>In this case we are interested in the (continuous) distribution of
body mass in three separate subpopulations: <code>Adelie</code>,
<code>Chinstrap</code>, and <code>Gentoo</code> penguins:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Yvrt</span> <span class="op">&lt;-</span> <span class="st">'body_mass'</span> <span class="co">## variate of interest</span></span>
<span><span class="co">## continuous variate, values require a different approach</span></span>
<span><span class="va">Yrange</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/extendrange.html" class="external-link">extendrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">penguin</span><span class="op">$</span><span class="va">body_mass</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Yvls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">Yrange</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">Yrange</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, by <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="co">## build Y object</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Yvls</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Yvrt</span></span>
<span></span>
<span><span class="va">Xvrt</span> <span class="op">&lt;-</span> <span class="st">'species'</span> <span class="co">## subpopulation variate</span></span>
<span><span class="va">Xvls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">penguin</span><span class="op">[</span>, <span class="va">Xvrt</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co">## subpopulation values</span></span>
<span><span class="co">## build X object</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Xvls</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">Xvrt</span></span>
<span></span>
<span><span class="va">Fanalysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Pr.html">Pr</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, learnt <span class="op">=</span> <span class="va">learntall</span>, parallel <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Registered doParallelSNOW with 4 workers</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Closing connections to cores.</span></span></code></pre></div>
<p>Here is the estimated frequency distribution of body mass within each
species</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Fanalysis</span>, col <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, legend <span class="op">=</span> <span class="st">'topright'</span><span class="op">)</span></span></code></pre></div>
<p><img src="figure/unnamed-chunk-10-1.png" width="100%"></p>
<p>Note how the plots above give us much more information than just a
set of estimates about medians and quantiles, or means and standard
deviations. Note also how the distributions are not Gaussian. We can
definitely say that Gentoo penguins (dot-dashed green curve) are
statistically heavier than Adélie or Chinstrap ones.</p>
<p>Consider also this question: “Do Adélie and Chinstrap penguins have
identical body-mass distributions?” The plots show that this question is
too generic and ambiguous. In the body-mass range between 4200 g and
5000 g, the two distributions (solid red, dashed blue) could maybe have
very similar values – there’s still some uncertainty there. But in the
body-mass range around 3750 g there’s a high probability that the two
distributions clearly differ; we see that their mean estimates are
outside each other’s 89%-credibility interval.</p>
<p><br></p>
<p><em>(TO BE CONTINUED)</em></p>
<p><br></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div class="section level4">
<h4 id="referencesexchang">On <em>exchangeability</em>:<a class="anchor" aria-label="anchor" href="#referencesexchang"></a>
</h4>
<ul>
<li><p>Bernardo, Smith: <a href="https://doi.org/10.1002/9780470316870" class="external-link"><em>Bayesian
Theory</em></a> (repr. 2000). See especially §§ 4.2–4.3, 4.6.</p></li>
<li><p>Dawid: <a href="https://doi.org/10.1093/acprof:oso/9780199695607.003.0002" class="external-link"><em>Exchangeability
and its ramifications</em></a> (2013).</p></li>
<li><p>de Finetti: <a href="https://www.numdam.org/item/AIHP_1937__7_1_1_0" class="external-link"><em>La prévision:
ses lois logiques, ses sources subjectives</em></a> (1937).</p></li>
<li><p>Heath, Sudderth: <a href="https://doi.org/10.1080/00031305.1976.10479175" class="external-link"><em>De Finetti’s
theorem on exchangeable variables</em></a> (1976).</p></li>
<li><p>Hewitt, Savage: <a href="https://doi.org/10.1090/S0002-9947-1955-0076206-8" class="external-link"><em>Symmetric
measures on Cartesian products</em></a> (1955).</p></li>
<li><p>Lindley, Novick: <a href="https://doi.org/10.1214/aos/1176345331" class="external-link"><em>The role of
exchangeability in inference</em></a> (1981).</p></li>
<li><p><strong><em>inferno</em></strong> accompanying manual: <a href="https://github.com/pglpm/inferno/raw/main/development/manual/optimal_predictor_machine.pdf" class="external-link"><em>Foundations
of inference under symmetry</em></a> (draft).</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="referencesbayes">On Bayesian theory in general:<a class="anchor" aria-label="anchor" href="#referencesbayes"></a>
</h4>
<ul>
<li><p>Jaynes: <a href="https://doi.org/10.1017/CBO9780511790423" class="external-link"><em>Probability
Theory</em></a> (2003).</p></li>
<li><p><a href="https://pglpm.github.io/ADA511" class="external-link"><em>ADA 511: Foundations
of data science</em></a>.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="referencesmedical">On medical decision-making:<a class="anchor" aria-label="anchor" href="#referencesmedical"></a>
</h4>
<ul>
<li><p>Sox, Higgins, Owens, Sanders Schmidler: <a href="https://doi.org/10.1002/9781119627876" class="external-link"><em>Medical Decision
Making</em></a> (3rd ed. 2024).</p></li>
<li><p>Hunink, Weinstein, Wittenberg, Drummond, Pliskin, Wong, Glasziou:
<a href="https://doi.org/10.1017/CBO9781139506779" class="external-link"><em>Decision Making
in Health and Medicine: Integrating Evidence and Values</em></a> (2nd
ed. 2014).</p></li>
</ul>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="format">Format for data and metadata files and their contents<a class="anchor" aria-label="anchor" href="#format"></a>
</h2>
<p>The functions of the <strong><em>inferno</em></strong> package accept
CSV files formatted as follows:</p>
<ul>
<li>Decimal values should be separated by a <em>dot</em>; no comma
should be used to separate thousands etc. Example:
<code>86342.75</code> .</li>
<li>Character and names should be quoted in single or double quotes.
Example: <code>"female"</code>.</li>
<li>Values should be separated by <em>commas</em>, not by tabs or
semicolons.</li>
<li>Missing values should be simply <em>empty</em>, not denoted by “NA”,
“missing”, “-”, or similar.</li>
</ul>
<p>Names of variates and character variate values should be strings
conforming to <a href="https://cran.r-project.org/doc/FAQ/R-FAQ.html#What-are-valid-names_003f" class="external-link">R’s
rules</a>.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by PierGianLuca Porta Mana, Aurora Grefsrud, Håkon Mydland, Maksim Ohvrill, Simen Hesthamar Hauge.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
